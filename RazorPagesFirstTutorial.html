<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Bootstrap 101 Template</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="row">
         
        <!--the side bar-->
        <div class="col-md-2">


        </div>

        <!--the contents-->
        <div class="col-md-9 col-md-offset-1">
            <h1><strong>Razor Pages with EF Core - 1</strong></h1>
            <br>

            <h4><strong>本文内容</strong><br></h4>

            <p>
                <link>入门<br>
                <link>添加模型<br>
                <link>基架<br>
                <link>使用DB<br>
                <link>更新页面<br>
                <link>添加搜索<br>
                <link>添加新字段<br>
                <link>添加验证<br>
            </p>
            <br />

            <p>
                <strong>通过本教程，你将GET到以下技能:</strong>
            </p>
            <ul>
                <li>创建Razor页面Web应用</li>
                <li>添加模型</li>
                <li>使用数据库</li>
                <li>添加搜索和验证</li>
            </ul>

            <p>
                该示例展示了一个管理和显示电影标题项的应用。
            </p>
            <br />
            <div>
                <h4>
                    <strong>工具</strong>
                </h4>
                <p>
                    <ul>
                        <li>已安装“ASP.NET 和 Web 开发”工作负载的 Visual Studio 2017 版本 15.9 或更高版本</li>
                        <li>.NET Core 2.2 SDK 或更高版本</li>
                    </ul>
                </p>
            </div>
            <br />
            <div>
                <h3>
                    <strong>第1步：创建Razor Web应用(Create a Razor web app)</strong>
                </h3>
                <p>
                    <ul>
                        <li>
                            从 Visual Studio“文件”菜单中，选择“新建”>“项目”。
                        </li>
                        <li>
                            创建新的 ASP.NET Core Web 应用程序。 将该项目命名为 RazorPagesMovie。 务必将该项目命名为 ContosoUniversity，以便复制/粘贴代码时命名空间相匹配。
                            <img url="">
                        </li>
                        <li>
                            在下拉列表中选择“ASP.NET Core 2.2”，然后选择“Web 应用程序”。
                            <img url="">
                        </li>
                    </ul>
                </p>

                <h4>
                    <span class="glyphicon glyphicon-grain" aria-hidden="true">  问题</span>
                </h4>
                <ol>
                    <li>VS自动添加了哪些文件夹</li>
                </ol>
            </div>
            <br />
            <div>
                <h3>
                    <strong>第2步：添加数据模型（add a data model)</strong>
                </h3>
                <p>
                    在此部分中，添加了用于管理数据库中的电影的类。
                    <br />
                    可以结合 Entity Framework Core (EF Core) 来使用这些类处理数据库。EF Core 是一种对象关系映射 (ORM) 框架，可以简化数据访问代码。
                    <br />
                    模型类称为 POCO 类（源自“简单传统 CLR 对象”），因为它们与 EF Core 没有任何依赖关系,只定义了存储在数据库中的数据的属性。
                </p>
                <p>
                    <ul>
                        <li>
                            右键单击“RazorPagesMovie”项目 >“添加” > “新建文件夹”。 将文件夹命名为“Models”。
                        </li>
                        <li>
                            右键单击“Models”文件夹。 选择“添加” > “类”。 将类命名“Movie”。
                        </li>
                        <li>
                            给Movie类添加如下属性（可复制粘贴以下所有代码）。
                        </li>
                    </ul>
                    <pre>
using System;
using System.ComponentModel.DataAnnotations;

namespace RazorPagesMovie.Models
{
    public class Movie
    {
        public int ID { get; set; }
        public string Title { get; set; }

        [DataType(DataType.Date)]
        public DateTime ReleaseDate { get; set; }
        public string Genre { get; set; }
        public decimal Price { get; set; }
    }
}
                    </pre>
                </p>

                <h4>
                    <span class="glyphicon glyphicon-grain" aria-hidden="true">  问题</span>
                </h4>
                <ol>
                    <li>属性分别代表什么</li>
                    <li>[DataType(DataType.Data)]有什么用</li>
                </ol>
            </div>
            <br />
            <div>
                <h3>
                    <strong>第3步：为此模型添加基架（Scaffold the movie model)</strong>
                </h3>
                <p>
                    在此部分中，将为刚刚创建的数据模型Movie添加基架。基架工具将生成前端页面，用于对“电影”模型执行创建、读取、更新和删除 (CRUD) 操作。
                </p>
                <p>
                    <ul>
                        <li>
                            右键单击 Pages 文件夹 >“Add” > “New Folder”。 将文件夹命名为“Movies”。
                        </li>
                        <li>
                            右键单击“Movies”文件夹。 选择“Add” >  “New Scaffold Item”。
                        </li>
                        <li>
                            在“Add Scaffold”对话框中，选择“Razor Pages using Entity Framework(CRUD)” > “Add”。
                        </li>
                        <li>
                            完成“使用实体框架(CRUD)添加 Razor Pages”对话框：
                            <ul>
                                <li>在“Model class”下拉列表中，选择“Movie (RazorPagesMovie.Models)。</li>
                                <li>
                                    在“Data Context class”行中，选择 +（加号）并接受生成的名称“RazorPagesMovie.Models.RazorPagesMovieContext”。
                                </li>
                                <li>选择“Add”。</li>
                            </ul>
                        </li>
                    </ul>
                </p>

                <h4>
                    <span class="glyphicon glyphicon-grain" aria-hidden="true">  问题</span>
                </h4>
                <ol>
                    <li>
                        <strong></strong>搭建基架后创建和修改了什么
                        <ul>
                            <li>
                                创建了文件：
                                <br />Pages/Movies/Create.cshtml、Edit.cshtml、Details.cshtml、Delete.cshtml、Edit.cshtml；
                                <br />Data/RazorPagesMovieContext.cs
                            </li>
                            <li>
                                修改了文件：startup.cs
                            </li>
                        </ul>
                    </li>
                </ol>
                <h4>
                    <span class="glyphicon glyphicon-grain" aria-hidden="true">让我们来研究一下基架到底生成了些什么代码</span>
                </h4>
                <p>
                    先看一下Pages/Movies/Index.cshtml，代码如下：
                    <pre>
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.RazorPages;
using Microsoft.EntityFrameworkCore;
using RazorPagesMovie.Models;

namespace RazorPagesMovie.Pages.Movies
{
    public class IndexModel : PageModel 
    {
        private readonly RazorPagesMovie.Models.RazorPagesMovieContext _context;

        public IndexModel(RazorPagesMovie.Models.RazorPagesMovieContext context)
        {
            _context = context;
        }

        public IList<Movie> Movie { get;set; }

        public async Task OnGetAsync()
        {
            Movie = await _context.Movie.ToListAsync();
        }
    }
}
</pre>
                    Razor页面派生自<code>Page Model</code>类。按照约定，<code>PageModel</code>派生的类的名字为<code><PageName>Model</code>。
                    <pre>
        public IndexModel(RazorPagesMovie.Models.RazorPagesMovieContext context)
        {
            _context = context;
        }
</pre>
                    此构造函数使用依赖注入（dependency injection）将数据上下文<code>RazorPagesMovieContext</code>添加到页面中。
                    <pre>
        public async Task OnGetAsync()
        {
            Movie = await _context.Movie.ToListAsync();
        }
</pre>
                    <code>onGetAsync()</code>方法或<code>onGet()</code>方用来初始化Razor页面。当页面发出请求时，函数将返回一个电影列表。
                    <br />
                    当 OnGet 返回 void 或 OnGetAsync 返回Task时，不使用任何返回方法。 当返回类型是 IActionResult 或 Task<IActionResult> 时，必须提供返回语句。 例如，Pages/Movies/Create.cshtml.cs OnPostAsync 方法：
                </p>
            </div>
            <br />
        </div>

    </div>

            <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
</body>
</html>